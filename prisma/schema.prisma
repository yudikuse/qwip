// =========================
// Prisma Schema COMPLETO
// =========================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"       // Supabase/Neon/Postgres
  url      = env("DATABASE_URL")
}

// =========================
// MODELS
// =========================

model Seller {
  id        String   @id @default(cuid())

  // Mantemos compatibilidade com o banco:
  // "phone" mapeado para a coluna já existente "phoneE164"
  phone     String?  @map("phoneE164")

  // "name" opcional (será coluna nova, sem quebrar dados existentes)
  name      String?

  createdAt DateTime @default(now())

  ads       Ad[]

  @@index([phone])
}

model Ad {
  id           String   @id @default(cuid())
  title        String
  description  String
  priceCents   Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // ===== Campos que já EXISTEM no seu banco (não remover) =====
  city        String
  uf          String
  lat         Float
  lng         Float
  centerLat   Float?
  centerLng   Float?
  radiusKm    Float?
  expiresAt   DateTime?
  isActive    Boolean  @default(true)

  // Relacionamento existente
  sellerId   String?
  seller     Seller?  @relation(fields: [sellerId], references: [id])

  // ===== NOVOS CAMPOS DE IMAGEM (opcionais p/ não quebrar) =====
  imageUrl     String?           // URL pública no storage (ex.: Vercel Blob)
  imageMime    String?           // ex.: "image/jpeg", "image/png"
  imageWidth   Int?
  imageHeight  Int?
  imageSha256  String?           // hash p/ dedupe/antiabuso

  // Índices
  @@index([imageSha256])
  @@index([city, uf])
  @@index([isActive, expiresAt])
}

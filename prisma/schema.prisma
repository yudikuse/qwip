// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Vendedor: dono dos anúncios (identificado pelo WhatsApp)
model Seller {
  id                 String   @id @default(uuid())
  phoneE164          String   @unique     // ex: +5511999998888
  whatsappVerifiedAt DateTime?
  createdAt          DateTime @default(now())

  ads                Ad[]
}

// Anúncio básico do MVP
model Ad {
  id          String   @id @default(uuid())
  sellerId    String
  seller      Seller   @relation(fields: [sellerId], references: [id])

  title       String
  description String
  priceCents  Int                 // armazenado em centavos
  imageUrl    String?

  city        String
  uf          String              // SP, RJ, GO...
  centerLat   Float
  centerLng   Float
  radiusKm    Int

  status      AdStatus @default(ACTIVE)
  expiresAt   DateTime
  createdAt   DateTime @default(now())

  @@index([sellerId])
  @@index([status, expiresAt])
}

// Sessão de OTP
model OtpSession {
  id        String   @id @default(uuid())
  phoneE164 String
  code      String
  createdAt DateTime @default(now())
  expiresAt DateTime
  consumed  Boolean  @default(false)

  @@index([phoneE164])
  @@index([expiresAt])
}

enum AdStatus {
  ACTIVE
  EXPIRED
  DRAFT
}
